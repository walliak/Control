C51 COMPILER V9.00   MAIN                                                                  04/05/2019 23:24:19 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Object\main.obj
COMPILER INVOKED BY: D:\KeilC51\C51\BIN\C51.EXE main.c BROWSE INCDIR(.\Peripheral_H;.\Common) DEBUG OBJECTEXTEND PRINT(.
                    -\List\main.lst) OBJECT(.\Object\main.obj)

line level    source

   1          #include "math.h"
   2          #include "init.h"
   3          #include "lcd.h"
   4          #include "key.h"
   5          #include "timer3.h"
   6          #include "C8051F020.h"
   7          
   8          //八拍  CCW = CounterClockWise ; CW = ClockWise;
   9           unsigned char code eightCCW[8]={0x08,0x0c,0x04,0x06,0x02,0x03,0x01,0x09};   //逆时钟旋转相序表 
  10           unsigned char code eightCW[8]={0x09,0x01,0x03,0x02,0x06,0x04,0x0c,0x08};    //正时钟旋转相序表
  11          
  12          //四拍
  13           unsigned char code fourCCW[4]={0x01,0x08,0x04,0x02};
  14           unsigned char code fourCW[4]={0x02,0x04,0x08,0x01};
  15           void Motor_CCW();
  16           void Motor_CW();
  17           void StopMotor();
  18           void Show();
  19          
  20          void Main()
  21          {       
  22   1               uchar key=0,flag=0;
  23   1               int i,N=64;
  24   1                       
  25   1               Init_Device();          
  26   1           DrawcharS("Project-4",1,4);
  27   1           DrawcharS("3.28--4.16",2,4);                                       
  28   1               DelayMSec(1000);
  29   1               Clear();
  30   1               P7=0x00;                               
  31   1               while(1)
  32   1               {      
  33   2                      Show();         
  34   2                      key = KeyScan();
  35   2                      if(key!=0)
  36   2                      {
  37   3                              switch(key)
  38   3                              {
  39   4                                      case 1: //顺时针转
  40   4                                                      Clear(); //清屏
  41   4                                                      Show();                         
  42   4                                                      while(1)
  43   4                                                      {
  44   5                                                              DrawhanziS("6",0,0);
  45   5                                                              Motor_CW();
  46   5                                                              flag=KeyScan();                                                 
  47   5                                                              if(flag==9)
  48   5                                                              break;                                                  
  49   5                                                      }
  50   4                                                      flag=0;
  51   4                                                      Clear();
  52   4                                                      break;
  53   4                                      case 2: //逆时针转
  54   4                                                      Clear(); //清屏
C51 COMPILER V9.00   MAIN                                                                  04/05/2019 23:24:19 PAGE 2   

  55   4                                                      Show();                                                 
  56   4                                                      while(1)
  57   4                                                      {
  58   5                                                              DrawhanziS("6",1,0);
  59   5                                                              Motor_CCW();
  60   5                                                              flag=KeyScan();
  61   5                                                              if(flag==9)
  62   5                                                              break;                                                  
  63   5                                                      }
  64   4                                                      flag=0;
  65   4                                                      Clear();
  66   4                                                      break;
  67   4                                      case 3: //转1/4圈
  68   4                                                      Clear(); //清屏 
  69   4                                                      DrawhanziS("6",2,0);                            
  70   4                                                      for(i=0;i<N/4;i++)
  71   4                                                      {
  72   5                                                              Motor_CW();
  73   5                                                      }
  74   4                                                      Clear();
  75   4                                                      break;
  76   4                                      case 4://转1/8圈
  77   4                                                      Clear(); //清屏 
  78   4                                                      DrawhanziS("6",3,0);                                            
  79   4                                                      for(i=0;i<N/8;i++)
  80   4                                                      {
  81   5                                                              Motor_CCW();
  82   5                                                      }
  83   4                                                      Clear();
  84   4                                                      break;
  85   4                                      case 5://设置转速
  86   4                                                      Clear();
  87   4      
  88   4                                      case 9://
  89   4                                                      StopMotor();
  90   4                                                      break;
  91   4                              
  92   4                                      default:break;
  93   4      
  94   4                              }
  95   3                      }
  96   2               } 
  97   1      }
  98          
  99          //电机旋转一周，不是外面所看到的一周，是里面的传动轮转了一周
 100          //正转8拍
 101          void Motor_CW(void)
 102          {
 103   1        uchar i,j;
 104   1        for(j=0;j<8;j++)
 105   1        {     
 106   2              for(i=0;i<8;i++)
 107   2              {
 108   3                      while(1)
 109   3                      {
 110   4                              P7=eightCW[i];
 111   4                              if(timeFlag==1)
 112   4                              {
 113   5                                      timeFlag=0;
 114   5                                      break;
 115   5                              }
 116   4                      }
C51 COMPILER V9.00   MAIN                                                                  04/05/2019 23:24:19 PAGE 3   

 117   3              }
 118   2                 
 119   2        }
 120   1      }
 121          
 122          //反转8拍
 123          void Motor_CCW(void)
 124          {
 125   1        uchar i,j;
 126   1        for(j=0;j<8;j++)     
 127   1        {  
 128   2              for(i=0;i<8;i++)        
 129   2               {
 130   3                      while(1)
 131   3                      {
 132   4                              P7=eightCCW[i];
 133   4                              if(timeFlag==1)
 134   4                              {
 135   5                                      timeFlag=0;
 136   5                                      break;
 137   5                              }
 138   4                      }
 139   3                 
 140   3               }
 141   2        }
 142   1      }
 143          
 144          void StopMotor(void)
 145          {
 146   1              P7=0x00;
 147   1      }
 148          
 149          void Show()
 150          {
 151   1              DrawcharS("1.",0,0),DrawhanziS("0234",0,1);
 152   1              DrawcharS("2.",1,0),DrawhanziS("1234",1,1);
 153   1              DrawcharS("3.",2,0),DrawhanziS("4",2,1),DrawcharS("1/4",2,4),DrawhanziS("5",2,4);
 154   1              DrawcharS("4.",3,0),DrawhanziS("4",3,1),DrawcharS("1/8",3,4),DrawhanziS("5",3,4);
 155   1      }
 156          
 157          void ShowSpeed()
 158          {
 159   1              
 160   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    535    ----
   CONSTANT SIZE    =     81    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
